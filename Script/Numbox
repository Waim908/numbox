#!/bin/bash
clear
stopserver
export DEFAULT_CONTAINER_NAME=$(cat ~/NumBox/default_startup_container)
rm -rf $TMPDIR/cmd 2>&1 >/dev/null
rm -rf $TMPDIR/container_name.txt 2>&1 >/dev/null
rm -rf ~/.config/pulse/
pulseaudio -k >/dev/null 2>&1 
pkill -f com.termux.x11 >/dev/null 2>&1
read L W H < ~/NumBox/custom-size
numbox_ver=$(cat ~/NumBox/.version) 
MAIN_MENU=$(dialog --title "ä¸»èœå•" --no-shadow --backtitle "NumBox ç‰ˆæœ¬ï¼š$numbox_ver" --menu "è§¦æŽ§æˆ–æ–¹å‘é”®é€‰æ‹©" $L $W $H \
  1 "ï¸ðŸ·å¯åŠ¨$DEFAULT_CONTAINER_NAME" \
  2 "ï¸ðŸ”§å®¹å™¨é€‰é¡¹" \
  3 "ðŸ“¦é€‰æ‹©å®¹å™¨æ‰“å¼€" \
  4 "å¯¼å…¥å®¹å™¨" \
  5 "è°ƒè¯•è®¾ç½®" \
  6 "turnipé©±åŠ¨è®¾ç½®" \
  7 "å…³äºŽ" \
  8 "æ”¯æŒNumBoxå¼€å‘" \
  9 "æŸ¥çœ‹å‘½ä»¤å¸®åŠ©" \
  10 "åœ¨çº¿ä¸‹è½½èµ„æºä¸Žæ›´æ–°" \
  98 "å¸è½½NumBox" \
  99 "é€€å‡º"  2>&1 >/dev/tty)
case $MAIN_MENU in
  1) if [ -z "$DEFAULT_CONTAINER_NAME" ]; then
    dialog --title "é”™è¯¯" --msgbox "æœªè®¾ç½®é»˜è®¤å¯åŠ¨å®¹å™¨" $L $W 2>&1 >/dev/tty && bash ~/NumBox/Numbox
  else
    clear
    if [[ -d ~/NumBox/container/$DEFAULT_CONTAINER_NAME ]]; then
      export CONTAINER_NAME=$DEFAULT_CONTAINER_NAME
      export screen="$(cat /sdcard/NumBox/container/$CONTAINER_NAME/screen_res)"
      bash ~/NumBox/startup-container.sh
    else
      dialog --title "é”™è¯¯" --msgbox "é»˜è®¤å®¹å™¨ $DEFAULT_CONTAINER_NAME ä¸å­˜åœ¨,å·²æ¸…é™¤é…ç½®" $L $W 2>&1 >/dev/tty && echo "" > ~/NumBox/default_startup_container && bash ~/NumBox/Numbox
    fi
  fi ;;
  2) SUBMENU_A=$(dialog --no-shadow --title "å®¹å™¨è®¾ç½®" --menu "è§¦æŽ§æˆ–æ–¹å‘é”®é€‰æ‹©" $L $W $H \
    1 "ï¼‹åˆ›å»ºå®¹å™¨" \
    2 "âœ–åˆ é™¤å®¹å™¨" \
    3 "âš™ç¼–è¾‘å®¹å™¨" \
    4 "è¿”å›žä¸Šçº§èœå•" 2>&1 > /dev/tty)
    case $SUBMENU_A in
    1) bash ~/NumBox/Create-container.sh ;;
    2) bash ~/NumBox/Del-container.sh ;;
    3) bash ~/NumBox/Set-container.sh ;;
    4) bash ~/NumBox/Numbox ;;
  esac ;;
  3) bash ~/NumBox/Open-container.sh ;;
  4) bash ~/NumBox/Import-container.sh ;;
  # 5) bash ~/NumBox/Drive-setup.sh ;;
  # 6) TEST=$(dialog --title "å›¾å½¢æ¸²æŸ“æµ‹è¯•" --menu "é€‰æ‹©ä¸€ä¸ªå›¾å½¢æ¸²æŸ“" $L $W $H \
  #   back "ðŸ”™è¿”å›ž" \
  #   Tips "!!!!æµ‹è¯•å‰å…ˆçœ‹è¯´æ˜Ž!!!!" \
  #   Vulkan "vkcube && mangohud" \
  #   GL "gears && GALLIUM_HUD" \
  #   PS "FPSä»…ä¾›å‚è€ƒ" 2>&1 >/dev/tty)
  # case $TEST in
  #   back) bash ~/NumBox/Numbox ;;
  #   Tips) clear
  #   echo "1.æŸäº›æƒ…å†µä¸‹ï¼Œvkcubeå’Œvkmarkç­‰vulkanæµ‹è¯•ç¨‹åºåœ¨å®‰è£…é©±åŠ¨ä¹‹åŽå‡ºçŽ°äº†æ²¡æœ‰æ¸²æŸ“ä»»ä½•å›¾å½¢çš„æƒ…å†µï¼Œè¿™å±žäºŽæ­£å¸¸çŽ°è±¡ï¼Œå› ä¸ºè¿™äº›æµ‹è¯•ç¨‹åºè²Œä¼¼æ²¡åŠžæ³•å¾ˆå¥½çš„åœ¨termuxä¸­æ­£å¸¸å·¥ä½œï¼Œå³ä½¿å¯ä»¥è¿è¡Œæ•°å€¼ä¸Šä¹Ÿä¼šå­˜åœ¨è¯¯å·®"
  #   echo "2.æµ‹è¯•å‰è¯·ç¡®ä¿å·²ç»å®‰è£…äº†å¯¹åº”çš„é©±åŠ¨"
  #   echo "3.Fpsæ•°å€¼ä»…ä¾›å‚è€ƒï¼Œvkcubeçš„fpsæ•°å€¼åº”è¯¥å’Œä½ è®¾å¤‡é”å®šçš„å¸§çŽ‡ç›¸å…³(ä¾‹å¦‚é”å®šäº†60æœ€é«˜è²Œä¼¼å°±æ˜¯60)"
  #   echo "4.è®¾å¤‡åˆ°è¾¾æ€§èƒ½ä¸Šé™ä¹‹åŽï¼Œåœ¨è¿è¡Œè´Ÿè½½é«˜çš„æƒ…å†µä¸‹ï¼Œä¸åŒvulkané©±åŠ¨çš„æ€§èƒ½å·®å¼‚å¯èƒ½é€æ¸å‡å°"
  #   echo "5.ç«–å±å’Œæ¨ªå±å¯èƒ½ä¼šæœ‰å¸§æ•°å·®å¼‚"
  #   echo "!!!é©±åŠ¨èƒ½ä¸èƒ½ä½¿ç”¨è¯·åœ¨wineçŽ¯å¢ƒä¸­æµ‹è¯•ï¼Œè€Œä¸æ˜¯termuxä¸Šçš„æµ‹è¯•è½¯ä»¶ï¼Œä¾‹å¦‚wrapperé©±åŠ¨ä¸‹ï¼Œvkcubeå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä½†å®žé™…ä¸ŠwineçŽ¯å¢ƒä¸­å¯ä»¥æ­£å¸¸ä½¿ç”¨dxvkæ¸¸çŽ©æ¸¸æˆå’Œæ¸²æŸ“æµ‹è¯•!!!"
  #   read -s -n1 -p "è¾“å…¥ä»»æ„å­—ç¬¦è¿”å›ž" && bash ~/NumBox/Numbox ;;
  #   Vulkan) clear
  # #  source ~/NumBox/drive/vulkan.conf
  #   termux-x11 :0 &
  #   echo "è¯·æ‰“å¼€x11ä»¥æŸ¥çœ‹å›¾å½¢ç•Œé¢,Ctrl+Cé€€å‡º"
  #   export DISPLAY=:0
  #   echo "ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"
  #   echo "MANGOHUD_CONFIGFILE=/sdcard/NumBox/mangohud.conf mangohud vkcube" ;;
  #   GL) clear
  # #  source ~/NumBox/drive/virgl.conf
  #   termux-x11 :0 &
  #   echo "è¯·æ‰“å¼€x11ä»¥æŸ¥çœ‹å›¾å½¢ç•Œé¢,Ctrl+Cé€€å‡º"
  #   export DISPLAY=:0
  #   export GALLIUM_HUD=fps
  #   echo "ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤"
  #   echo "gears" ;;
  #   PS) bash ~/NumBox/Numbox ;;
  # esac ;;
  5) bash ~/NumBox/Debug-set.sh ;;
  6) bash ~/NumBox/Drive-setup2.sh ;;
  7) numbox_ver=$(cat ~/NumBox/.version) 
  about_info () {
    about_menu=$(dialog --title "å…³äºŽ" --menu "å½“å‰NumBoxç‰ˆæœ¬ $numbox_ver" $L $W $H \
    back "ðŸ”™è¿”å›ž" \
    NumBoxä»“åº“ "Waim908/numbox" \
    wine-termux "Waim908/wine-termux" \
    info "ååˆ†æ„Ÿè°¢ä»¥ä¸‹é¡¹ç›®" \
    termuxåˆä½“ç‰ˆ "jiaxinchen-max/termux-app" \
    termux "termux/termux-app" \
    termux-x11 "termux/termux-x11" \
    glibcåº“ "mebabo1/menano" \
    termux-glibc "termux-pacman/glibc-packages" \
    box64 "ptitSeb/box64" \
    dxvk "doitsujin/dxvk" \
    dxvk-gplasync "Ph42oN/dxvk-gplasync" \
    dxvk-async "Sporif/dxvk-async" \
    cnc-ddraw "FunkyFr3sh/cnc-ddraw" \
    vkd3d "HansKristian-Work/vkd3d-proton" \
    wined3d "https://fdossena.com/?p=wined3d/index.frag" \
    mesa3d "https://www.mesa3d.org/" \
    wine "https://www.winehq.org/" 2>&1 >/dev/tty)
    case $about_menu in
      back) bash ~/NumBox/Numbox ;;
      NumBoxä»“åº“)  termux-open-url https://github.com/Waim908/numbox && about_info;;
      wineç¼–è¯‘) termux-open-url https://github.com/Waim908/wine-termux && about_info ;;
      info) about_info ;;
      termuxåˆä½“ç‰ˆ) termux-open-url https://github.com/jiaxinchen-max/termux-app && about_info ;;
      termux) termux-open-url https://github.com/termux/termux-app/ && about_info ;;
      termux-x11) termux-open-url https://github.com/termux/termux-x11 && about_info ;;
      glibcåº“) termux-open-url https://github.com/mebabo1/menano && about_info ;;
      termux-glibc) termux-open-url https://github.com/termux-pacman/glibc-packages && about_info ;;
#      é©±åŠ¨åŒ…) termux-open-url https://github.com/sabamdarif/termux-desktop && about_info ;;
      box64) termux-open-url https://github.com/ptitSeb/box64 && about_info ;;
      dxvk) termux-open-url https://github.com/doitsujin/dxvk && about_info ;;
      dxvk-gplasync) termux-open-url https://gitlab.com/Ph42oN/dxvk-gplasync && about_info ;;
      dxvk-async) termux-open-url https://github.com/Sporif/dxvk-async && about_info ;;
      cnc-ddraw) termux-open-url https://github.com/FunkyFr3sh/cnc-ddraw && about_info ;;
      vkd3d) termux-open-url https://github.com/HansKristian-Work/vkd3d-proton && about_info ;;
      wined3d) termux-open-url https://fdossena.com/?p=wined3d/index.frag && about_info ;;
      mesa3d) termux-open-url https://www.mesa3d.org/ && about_info ;;
      wine) termux-open-url https://www.winehq.org/ && about_info ;;
    esac
  }
  about_info ;;
  8) support_menu=$(dialog --title "æ”¯æŒNumBoxå¼€å‘" --menu "é€‰æ‹©ä¸€ä¸ªé€‰é¡¹" $L $W $H \
    back "ðŸ”™è¿”å›ž" \
    1 "ðŸ“ºå…³æ³¨ä½œè€…(å“”å“©å“”å“©)" \
    2 "ðŸŸè®¿é—®çˆ±å‘ç”µä¸»é¡µ" 2>&1 >/dev/tty)
  case $support_menu in
    back) bash ~/NumBox/Numbox ;;
    1) termux-open-url https://space.bilibili.com/483380143 & dialog --msgbox "è°¢å•¦!!â˜†âŒ’(*ï¼¾-ã‚œ)v" $L $W 2>&1 >/dev/tty && bash ~/NumBox/Numbox ;;
    2) termux-open-url https://afdian.com/a/NumBox_Project2025 & dialog --msgbox "è°¢å•¦!!â˜†âŒ’(*ï¼¾-ã‚œ)v" $L $W 2>&1 >/dev/tty && bash ~/NumBox/Numbox ;;
  esac ;;
  9) clear
  echo "NumBox"
  echo "numbox"
  echo "nb"
  echo "ä»¥ä¸Šéƒ½å¯ä»¥å¯åŠ¨NumBox"
  echo "stopwine"
  echo "sw"
  echo "å¦‚æžœä½ æƒ³ç›´æŽ¥è¾“å…¥å‘½ä»¤åœæ­¢å®¹å™¨ï¼Œè¾“å…¥ä»¥ä¸Šå‘½ä»¤åœ¨termuxå³å¯"
  echo "æˆ–è€…å¼€å§‹èœå•æ„å¤–ç»“æŸè¿”å›žç»ˆç«¯äº†ï¼Œè¿˜æ˜¯è¾“å…¥åœæ­¢å®¹å™¨çš„å‘½ä»¤ç»“æŸå®¹å™¨å§"
  echo "é¡ºå¸¦ä¸€æç»“æŸå®¹å™¨å‘½ä»¤ä¼šå¯¼è‡´æ²¡ä¿å­˜çš„ä¸œè¥¿ä¸¢å¤±ï¼Œå› ä¸ºè¿™æ˜¯ç»“æŸwineè¿›ç¨‹"
  read -s -n1 -p "è¾“å…¥ä»»æ„å­—ç¬¦è¿”å›ž" && bash ~/NumBox/Numbox ;;
  10) bash ~/NumBox/Download-resource.sh ;;
  98) clear
  read -p "æ˜¯å¦å¸è½½NumBoxï¼Ÿè¾“å…¥Removeå¼€å§‹å¸è½½,è¾“å…¥ä»»æ„å­—ç¬¦é€€å‡º:" remove_nb
  if [[ $remove_nb == Remove ]]; then
    echo "clear" > $TMPDIR/remove.sh
    echo "echo å¼€å§‹å¸è½½NumBox" >> $TMPDIR/remove.sh
    echo "rm -rf /sdcard/NumBox" >> $TMPDIR/remove.sh
    echo "rm -rf $PREFIX/glibc" >> $TMPDIR/remove.sh
    echo "rm -rf ~/NumBox/" >> $TMPDIR/remove.sh
    echo "rm -rf ~/.profile" >> $TMPDIR/remove.sh
    echo "echo å¸è½½å®Œæˆ" >> $TMPDIR/remove.sh
    echo "sleep 5 && rm \$0" >> $TMPDIR/remove.sh
    bash $TMPDIR/removenb.sh
  else
    bash ~/NumBox/Numbox
  fi ;;
  99) exit 0 ;;
esac